parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"zhyU":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(e){return null!==e&&"object"===t(e)&&"function"==typeof e.pipe}function o(o){return e(o)&&!1!==o.writable&&"function"==typeof o._write&&"object"===t(o._writableState)}function r(o){return e(o)&&!1!==o.readable&&"function"==typeof o._read&&"object"===t(o._readableState)}function n(t){return o(t)&&r(t)}function u(t){return n(t)&&"function"==typeof t._transform}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isDuplexStream=n,exports.isReadableStream=r,exports.isStream=e,exports.isTransformStream=u,exports.isWritableStream=o;
},{}],"wEMR":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var e=require("buffer").Buffer;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.TorusInPageProvider=exports.TORUS_BUILD_ENV=exports.PAYMENT_PROVIDER=exports.LOGIN_PROVIDER=exports.BUTTON_POSITION=void 0;var t=l(require("@babel/runtime/helpers/defineProperty")),r=require("@solana/web3.js"),n=require("@toruslabs/base-controllers"),i=require("@toruslabs/http-helpers"),o=require("@toruslabs/openlogin-jrpc"),a=require("eth-rpc-errors"),s=require("is-stream"),u=l(require("pump")),c=l(require("loglevel")),d=l(require("fast-deep-equal"));function l(e){return e&&e.__esModule?e:{default:e}}function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function p(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t=k();return function(){var r,n=R(e);if(t){var i=R(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return I(this,r)}}function I(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function C(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){T(o,n,i,a,s,"next",e)}function s(e){T(o,n,i,a,s,"throw",e)}a(void 0)})}}var P={errors:{disconnected:function(){return"Torus: Lost connection to Torus."},permanentlyDisconnected:function(){return"Torus: Disconnected from iframe. Page reload required."},unsupportedSync:function(e){return"Torus: The Torus Ethereum provider does not support synchronous methods like ".concat(e," without a callback parameter.")},invalidDuplexStream:function(){return"Must provide a Node.js-style duplex stream."},invalidOptions:function(e){return"Invalid options. Received: { maxEventListeners: ".concat(e,"}")},invalidRequestArgs:function(){return"Expected a single, non-array, object argument."},invalidRequestMethod:function(){return"'args.method' must be a non-empty string."},invalidRequestParams:function(){return"'args.params' must be an object or array if provided."},invalidLoggerObject:function(){return"'args.logger' must be an object if provided."},invalidLoggerMethod:function(e){return"'args.logger' must include required method '".concat(e,"'.")}},info:{connected:function(e){return'Torus: Connected to chain with ID "'.concat(e,'".')}},warnings:{}},S={MOONPAY:"moonpay",WYRE:"wyre",RAMPNETWORK:"rampnetwork",XANPOOL:"xanpool",MERCURYO:"mercuryo",TRANSAK:"transak"};exports.PAYMENT_PROVIDER=S;var E={PRODUCTION:"production",DEVELOPMENT:"development",TESTING:"testing"};exports.TORUS_BUILD_ENV=E;var A={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"};exports.BUTTON_POSITION=A;var x={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless"};exports.LOGIN_PROVIDER=x;var L={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}},N={supportedVerifierList:[x.GOOGLE,x.REDDIT,x.DISCORD],api:"https://api.tor.us",translations:L,prodTorusUrl:"",localStorageKey:"torus-".concat(window.location.hostname)},D=c.default.getLogger("solana-embed");function q(){return function(e,t,r){"string"==typeof e.method&&e.method||(t.error=a.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:e})),r(function(e){var r=t.error;return r?(D.error("Torus - RPC Error: ".concat(r.message),r),e()):e()})}}function M(e,t,r){var n='Torus: Lost connection to "'.concat(e,'".');null!=t&&t.stack&&(n+="\n".concat(t.stack)),D.warn(n),r&&r.listenerCount("error")>0&&r.emit("error",n)}var U=function(){return Math.random().toString(36).slice(2)},j=function(){var e=C(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="testing"===e.t0?3:"development"===e.t0?6:9;break;case 3:return r="https://solana-testing.tor.us",n="debug",e.abrupt("break",12);case 6:return r="http://localhost:8080",n="debug",e.abrupt("break",12);case 9:return r="https://solana.tor.us",n="error",e.abrupt("break",12);case 12:return e.abrupt("return",{torusUrl:r,logLevel:n});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=window.navigator.language||"en-US",t=e.split("-");return e=Object.prototype.hasOwnProperty.call(N.translations,t[0])?t[0]:"en"},F={height:660,width:375},H={height:740,width:1315},z={height:700,width:1200},K={height:600,width:400};function B(e){var t;try{t=window[e];var r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(n){return n&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&t&&0!==t.length}}function G(e){var t=e.width,r=e.height,n=void 0!==window.screenLeft?window.screenLeft:window.screenX,i=void 0!==window.screenTop?window.screenTop:window.screenY,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,s=Math.abs((o-t)/2/1+n),u=Math.abs((a-r)/2/1+i);return"titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=".concat(r/1,",width=").concat(t/1,",top=").concat(u,",left=").concat(s)}var V=function(e){switch(e){case"mainnet-beta":return{blockExplorerUrl:"https://explorer.solana.com",chainId:"0x1",displayName:"Solana Mainnet",logo:"solana.svg",rpcTarget:"https://api.mainnet-beta.solana.com",ticker:"SOL",tickerName:"Solana Token"};case"testnet":return{blockExplorerUrl:"https://explorer.solana.com",chainId:"0x2",displayName:"Solana Testnet",logo:"solana.svg",rpcTarget:"https://api.testnet.solana.com",ticker:"SOL",tickerName:"Solana Token"};case"devnet":return{blockExplorerUrl:"https://explorer.solana.com",chainId:"0x3",displayName:"Solana Devnet",logo:"solana.svg",rpcTarget:"https://api.devnet.solana.com",ticker:"SOL",tickerName:"Solana Token"};default:return}},J=function(e){y(i,o.SafeEventEmitter);var r=b(i);function i(e,a){var c;v(this,i);var d=a.maxEventListeners,l=void 0===d?100:d,h=a.jsonRpcStreamName,p=void 0===h?"provider":h;if(c=r.call(this),(0,t.default)(O(c),"isTorus",void 0),(0,t.default)(O(c),"_rpcEngine",void 0),(0,t.default)(O(c),"jsonRpcConnectionEvents",void 0),(0,t.default)(O(c),"_state",void 0),!(0,s.isDuplexStream)(e))throw new Error(P.errors.invalidDuplexStream());c.isTorus=!0,c.setMaxListeners(l),c._handleConnect=c._handleConnect.bind(O(c)),c._handleDisconnect=c._handleDisconnect.bind(O(c)),c._handleStreamDisconnect=c._handleStreamDisconnect.bind(O(c)),c._rpcRequest=c._rpcRequest.bind(O(c)),c._initializeState=c._initializeState.bind(O(c)),c.request=c.request.bind(O(c)),c.sendAsync=c.sendAsync.bind(O(c));var f=new o.ObjectMultiplex;(0,u.default)(e,f,e,c._handleStreamDisconnect.bind(O(c),"Torus")),f.ignoreStream("phishing");var m=(0,o.createStreamMiddleware)();(0,u.default)(m.stream,f.createStream(p),m.stream,c._handleStreamDisconnect.bind(O(c),"Torus RpcProvider"));var g=new o.JRPCEngine;return g.push((0,o.createIdRemapMiddleware)()),g.push(q()),g.push((0,n.createLoggerMiddleware)({origin:location.origin})),g.push(m.middleware),c._rpcEngine=g,c.jsonRpcConnectionEvents=m.events,c}return w(i,[{key:"request",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"object"===m(t)&&!Array.isArray(t)){e.next=2;break}throw a.ethErrors.rpc.invalidRequest({message:P.errors.invalidRequestArgs(),data:t});case 2:if(r=t.method,n=t.params,"string"==typeof r&&0!==r.length){e.next=5;break}throw a.ethErrors.rpc.invalidRequest({message:P.errors.invalidRequestMethod(),data:t});case 5:if(void 0===n||Array.isArray(n)||"object"===m(n)&&null!==n){e.next=7;break}throw a.ethErrors.rpc.invalidRequest({message:P.errors.invalidRequestParams(),data:t});case 7:return e.abrupt("return",new Promise(function(e,t){i._rpcRequest({method:r,params:n},(0,o.getRpcPromiseCallback)(e,t))}));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){this._rpcRequest(e,t)}},{key:"sendAsync",value:function(e){var t=this;return new Promise(function(r,n){t._rpcRequest(e,(0,o.getRpcPromiseCallback)(r,n))})}},{key:"_handleStreamDisconnect",value:function(e,t){M(e,t,this),this._handleDisconnect(!1,t?t.message:void 0)}}]),i}(),Z=function(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];e.addEventListener(t,function n(){r.apply(void 0,i),e.removeEventListener(t,n)})};function Y(){return Q.apply(this,arguments)}function Q(){return(Q=C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){"loading"!==document.readyState?e():Z(document,"DOMContentLoaded",e)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var X=function(e){var t=window.document.createElement("template"),r=e.trim();return t.innerHTML=r,t.content.firstChild},$=function(e){y(n,o.SafeEventEmitter);var r=b(n);function n(e){var i;v(this,n);var o=e.url,a=e.target,s=e.features;return i=r.call(this),(0,t.default)(O(i),"url",void 0),(0,t.default)(O(i),"target",void 0),(0,t.default)(O(i),"features",void 0),(0,t.default)(O(i),"window",void 0),(0,t.default)(O(i),"windowTimer",void 0),(0,t.default)(O(i),"iClosedWindow",void 0),i.url=o,i.target=a||"_blank",i.features=s||G(z),i.window=void 0,i.windowTimer=void 0,i.iClosedWindow=!1,i._setupTimer(),i}return w(n,[{key:"_setupTimer",value:function(){var e=this;this.windowTimer=Number(setInterval(function(){e.window&&e.window.closed&&(clearInterval(e.windowTimer),e.iClosedWindow||e.emit("close"),e.iClosedWindow=!1,e.window=void 0),void 0===e.window&&clearInterval(e.windowTimer)},500))}},{key:"open",value:function(){var e;return this.window=window.open(this.url.href,this.target,this.features),null!==(e=this.window)&&void 0!==e&&e.focus&&this.window.focus(),Promise.resolve()}},{key:"close",value:function(){this.iClosedWindow=!0,this.window&&this.window.close()}},{key:"redirect",value:function(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}]),n}();function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function te(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ee(Object(n),!0).forEach(function(r){(0,t.default)(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var re=function(e){y(i,J);var r=b(i);function i(e,o){var a;v(this,i);var s=o.maxEventListeners,u=void 0===s?100:s,c=o.jsonRpcStreamName,d=void 0===c?"provider":c;a=r.call(this,e,{maxEventListeners:u,jsonRpcStreamName:d}),(0,t.default)(O(a),"embedTranslations",void 0),(0,t.default)(O(a),"torusUrl",void 0),(0,t.default)(O(a),"dappStorageKey",void 0),(0,t.default)(O(a),"windowRefs",void 0),(0,t.default)(O(a),"tryWindowHandle",void 0),(0,t.default)(O(a),"torusAlertContainer",void 0),(0,t.default)(O(a),"torusIframe",void 0),a._state=te({},i._defaultState),a.torusUrl="",a.dappStorageKey="";var l=N.translations[W()];a.embedTranslations=l.embed,a.windowRefs={},a.on("connect",function(){a._state.isConnected=!0});return a.jsonRpcConnectionEvents.on("notification",function(e){var t=e.method,r=e.params;if(t===n.COMMUNICATION_NOTIFICATIONS.IFRAME_STATUS){var i=r.isFullScreen,o=r.rid;a._displayIframe({isFull:i,rid:o})}else if(t===n.COMMUNICATION_NOTIFICATIONS.CREATE_WINDOW){var s=r.windowId,u=r.url;a._createPopupBlockAlert(s,u)}else if(t===n.COMMUNICATION_NOTIFICATIONS.CLOSE_WINDOW)a._handleCloseWindow(r);else if(t===n.COMMUNICATION_NOTIFICATIONS.USER_LOGGED_IN){var c=r.currentLoginProvider;a._state.isLoggedIn=!0,a._state.currentLoginProvider=c}else t===n.COMMUNICATION_NOTIFICATIONS.USER_LOGGED_OUT&&(a._state.isLoggedIn=!1,a._state.currentLoginProvider=null,a._displayIframe())}),a}return w(i,[{key:"isLoggedIn",get:function(){return this._state.isLoggedIn}},{key:"isIFrameFullScreen",get:function(){return this._state.isIFrameFullScreen}},{key:"isConnected",value:function(){return this._state.isConnected}},{key:"_initializeState",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r,i,o,a,s,u,c,d=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.torusUrl,i=t.dappStorageKey,o=t.torusAlertContainer,a=t.torusIframe,this.torusUrl=r,this.dappStorageKey=i,this.torusAlertContainer=o,this.torusIframe=a,this.torusIframe.addEventListener("load",function(){d._state.isIFrameFullScreen||d._displayIframe()}),e.next=9,this.request({method:n.COMMUNICATION_JRPC_METHODS.GET_PROVIDER_STATE,params:[]});case 9:s=e.sent,u=s.currentLoginProvider,c=s.isLoggedIn,this._handleConnect(u,c),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),D.error("Torus: Failed to get initial state. Please report this bug.",e.t0);case 18:return e.prev=18,D.info("initialized communication state"),this._state.initialized=!0,this.emit("_initialized"),e.finish(18);case 23:case"end":return e.stop()}},e,this,[[0,15,18,23]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_handleWindow",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.url,o=r.target,a=r.features,s=new URL(i||"".concat(this.torusUrl,"/redirect?windowId=").concat(e));this.dappStorageKey&&(s.hash?s.hash+="&dappStorageKey=".concat(this.dappStorageKey):s.hash="#dappStorageKey=".concat(this.dappStorageKey));var u=new $({url:s,target:o,features:a});u.open(),u.window?(this.windowRefs[e]=u,this.request({method:n.COMMUNICATION_JRPC_METHODS.OPENED_WINDOW,params:{windowId:e}}),u.once("close",function(){delete t.windowRefs[e],t.request({method:n.COMMUNICATION_JRPC_METHODS.CLOSED_WINDOW,params:{windowId:e}})})):this._createPopupBlockAlert(e,s.href)}},{key:"_displayIframe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.isFull,r=void 0!==t&&t,i=e.rid,o=void 0===i?"":i,a={};if(r)a.display="block",a.width="100%",a.height="100%",a.top="0px",a.right="0px",a.left="0px",a.bottom="0px";else switch(a.display=this._state.torusWidgetVisibility?"block":"none",a.height="70px",a.width="70px",this._state.buttonPosition){case A.TOP_LEFT:a.top="0px",a.left="0px",a.right="auto",a.bottom="auto";break;case A.TOP_RIGHT:a.top="0px",a.right="0px",a.left="auto",a.bottom="auto";break;case A.BOTTOM_RIGHT:a.bottom="0px",a.right="0px",a.top="auto",a.left="auto";break;case A.BOTTOM_LEFT:default:a.bottom="0px",a.left="0px",a.top="auto",a.right="auto"}Object.assign(this.torusIframe.style,a),this._state.isIFrameFullScreen=r,this.request({method:n.COMMUNICATION_JRPC_METHODS.IFRAME_STATUS,params:{isIFrameFullScreen:r,rid:o}})}},{key:"hideTorusButton",value:function(){this._state.torusWidgetVisibility=!1,this._displayIframe()}},{key:"showTorusButton",value:function(){this._state.torusWidgetVisibility=!0,this._displayIframe()}},{key:"_rpcRequest",value:function(e,t){var r=t,n=e;Array.isArray(n)||n.jsonrpc||(n.jsonrpc="2.0"),this.tryWindowHandle(n,r)}},{key:"_handleConnect",value:function(e,t){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{currentLoginProvider:e,isLoggedIn:t}),D.debug(P.info.connected(e)))}},{key:"_handleDisconnect",value:function(e,t){var r;(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e)&&(this._state.isConnected=!1,e?(r=new a.EthereumRpcError(1013,t||P.errors.disconnected()),D.debug(r)):(r=new a.EthereumRpcError(1011,t||P.errors.permanentlyDisconnected()),D.error(r),this._state.currentLoginProvider=null,this._state.isLoggedIn=!1,this._state.torusWidgetVisibility=!1,this._state.isIFrameFullScreen=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r))}},{key:"_handleCloseWindow",value:function(e){var t=e.windowId;this.windowRefs[t]&&(this.windowRefs[t].close(),delete this.windowRefs[t])}},{key:"_createPopupBlockAlert",value:function(){var e=C(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getLogoUrl(),i=X('<div id="torusAlert" class="torus-alert--v2">'+'<div id="torusAlert__logo"><img src="'.concat(n,'" /></div>')+"<div>"+'<h1 id="torusAlert__title">'.concat(this.embedTranslations.actionRequired,"</h1>")+'<p id="torusAlert__desc">'.concat(this.embedTranslations.pendingAction,"</p>")+"</div></div>"),o=X('<div><a id="torusAlert__btn">'.concat(this.embedTranslations.continue,"</a></div>")),(a=X('<div id="torusAlert__btn-container"></div>')).appendChild(o),i.appendChild(a),s=function(){o.addEventListener("click",function(){c._handleWindow(t,{url:r,target:"_blank",features:G(K)}),i.remove(),0===c.torusAlertContainer.children.length&&(c.torusAlertContainer.style.display="none")})},u=function(){c.torusAlertContainer.appendChild(i)},e.next=10,Y();case 10:u(),s(),this.torusAlertContainer.style.display="block";case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getLogoUrl",value:function(){return"".concat(this.torusUrl,"/images/torus_icon-blue.svg")}}]),i}();function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ie(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ne(Object(n),!0).forEach(function(r){(0,t.default)(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}(0,t.default)(re,"_defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,hasEmittedConnection:!1,torusWidgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1});var oe=function(e){y(i,J);var r=b(i);function i(e,o){var a;v(this,i);var s=o.maxEventListeners,u=void 0===s?100:s,c=o.jsonRpcStreamName,d=void 0===c?"provider":c;a=r.call(this,e,{maxEventListeners:u,jsonRpcStreamName:d}),(0,t.default)(O(a),"chainId",void 0),(0,t.default)(O(a),"selectedAddress",void 0),(0,t.default)(O(a),"tryWindowHandle",void 0),a._state=ie({},i._defaultState),a.selectedAddress=null,a.chainId=null,a._handleAccountsChanged=a._handleAccountsChanged.bind(O(a)),a._handleChainChanged=a._handleChainChanged.bind(O(a)),a._handleUnlockStateChanged=a._handleUnlockStateChanged.bind(O(a)),a.on("connect",function(){a._state.isConnected=!0});return a.jsonRpcConnectionEvents.on("notification",function(e){var t=e.method,r=e.params;t===n.PROVIDER_NOTIFICATIONS.ACCOUNTS_CHANGED?a._handleAccountsChanged(r):t===n.PROVIDER_NOTIFICATIONS.UNLOCK_STATE_CHANGED?a._handleUnlockStateChanged(r):t===n.PROVIDER_NOTIFICATIONS.CHAIN_CHANGED&&a._handleChainChanged(r)}),a}return w(i,[{key:"isConnected",value:function(){return this._state.isConnected}},{key:"_initializeState",value:function(){var e=C(regeneratorRuntime.mark(function e(){var t,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request({method:n.PROVIDER_JRPC_METHODS.GET_PROVIDER_STATE,params:[]});case 3:t=e.sent,r=t.accounts,i=t.chainId,o=t.isUnlocked,this.emit("connect",{chainId:i}),this._handleChainChanged({chainId:i}),this._handleUnlockStateChanged({accounts:r,isUnlocked:o}),this._handleAccountsChanged(r),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),D.error("Torus: Failed to get initial state. Please report this bug.",e.t0);case 16:return e.prev=16,D.info("initialized provider state"),this._state.initialized=!0,this.emit("_initialized"),e.finish(16);case 21:case"end":return e.stop()}},e,this,[[0,13,16,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"_rpcRequest",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t,o=e;if(!Array.isArray(o))if(o.jsonrpc||(o.jsonrpc="2.0"),"solana_accounts"===o.method||"solana_requestAccounts"===o.method)i=function(e,i){r._handleAccountsChanged(i.result||[],"solana_accounts"===o.method,n),t(e,i)};else if("wallet_getProviderState"===o.method)return void this._rpcEngine.handle(e,i);this.tryWindowHandle(o,i)}},{key:"_handleConnect",value:function(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),D.debug(P.info.connected(e)))}},{key:"_handleDisconnect",value:function(e,t){var r;(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e)&&(this._state.isConnected=!1,e?(r=new a.EthereumRpcError(1013,t||P.errors.disconnected()),D.debug(r)):(r=new a.EthereumRpcError(1011,t||P.errors.permanentlyDisconnected()),D.error(r),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r))}},{key:"_handleAccountsChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e;Array.isArray(n)||(D.error("Torus: Received non-array accounts parameter. Please report this bug.",n),n=[]);var i,o=h(e);try{for(o.s();!(i=o.n()).done;){if("string"!=typeof i.value){D.error("Torus: Received non-string account. Please report this bug.",e),n=[];break}}}catch(a){o.e(a)}finally{o.f()}(0,d.default)(this._state.accounts,n)||(t&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!r&&D.error('Torus: "solana_accounts" unexpectedly updated accounts. Please report this bug.',n),this._state.accounts=n,this.emit("accountsChanged",n)),this.selectedAddress!==n[0]&&(this.selectedAddress=n[0]||null)}},{key:"_handleChainChanged",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).chainId;e?"loading"===e?this._handleDisconnect(!0):(this._handleConnect(e),e!==this.chainId&&(this.chainId=e,this._state.initialized&&this.emit("chainChanged",this.chainId))):D.error("Torus: Received invalid network parameters. Please report this bug.",{chainId:e})}},{key:"_handleUnlockStateChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.accounts,r=e.isUnlocked;"boolean"==typeof r?r!==this._state.isUnlocked&&(this._state.isUnlocked=r,this._handleAccountsChanged(t||[])):D.error("Torus: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:r})}}]),i}();function ae(e){return new Promise(function(t,r){try{var n=document.createElement("img");n.onload=function(){return t(!0)},n.onerror=function(){return t(!1)},n.src=e}catch(i){r(i)}})}exports.TorusInPageProvider=oe,(0,t.default)(oe,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});var se=function(e){var t=e.document,r=t.querySelector('head > meta[property="og:site_name"]');if(r)return r.content;var n=t.querySelector('head > meta[name="title"]');return n?n.content:t.title&&t.title.length>0?t.title:e.location.hostname};function ue(e){return ce.apply(this,arguments)}function ce(){return(ce=C(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=t.document,n=r.querySelector('head > link[rel="shortcut icon"]'),e.t0=n,!e.t0){e.next=8;break}return e.next=7,ae(n.href);case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=10;break}return e.abrupt("return",n.href);case 10:if(n=Array.from(r.querySelectorAll('head > link[rel="icon"]')).find(function(e){return Boolean(e.href)}),e.t1=n,!e.t1){e.next=16;break}return e.next=15,ae(n.href);case 15:e.t1=e.sent;case 16:if(!e.t1){e.next=18;break}return e.abrupt("return",n.href);case 18:return e.abrupt("return","");case 21:return e.prev=21,e.t2=e.catch(0),e.abrupt("return","");case 24:case"end":return e.stop()}},e,null,[[0,21]])}))).apply(this,arguments)}var de=function(){var e=C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=se(window),e.next=3,ue(window);case 3:return e.t1=e.sent,e.abrupt("return",{name:e.t0,icon:e.t1});case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function he(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?le(Object(n),!0).forEach(function(r){(0,t.default)(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var pe=["send_transaction","sign_transaction","sign_all_transactions","sign_message","connect"],fe=[n.COMMUNICATION_JRPC_METHODS.SET_PROVIDER],me=B("localStorage");!function(){var e=C(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"undefined"!=typeof document){e.next=3;break}return e.abrupt("return");case 3:return t=document.createElement("link"),e.next=6,j("production");case 6:r=e.sent,n=r.torusUrl,t.href="".concat(n,"/frame"),t.crossOrigin="anonymous",t.type="text/html",t.rel="prefetch",t.relList&&t.relList.supports&&t.relList.supports("prefetch")&&document.head.appendChild(t),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),D.warn(e.t0);case 18:case"end":return e.stop()}},e,null,[[0,15]])}));return function(){return e.apply(this,arguments)}}()();var ve=function(){function a(){v(this,a);var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modalZIndex,r=void 0===e?99999:e;(0,t.default)(this,"isInitialized",void 0),(0,t.default)(this,"torusAlert",void 0),(0,t.default)(this,"modalZIndex",void 0),(0,t.default)(this,"alertZIndex",void 0),(0,t.default)(this,"requestedLoginProvider",void 0),(0,t.default)(this,"provider",void 0),(0,t.default)(this,"communicationProvider",void 0),(0,t.default)(this,"dappStorageKey",void 0),(0,t.default)(this,"torusAlertContainer",void 0),(0,t.default)(this,"torusUrl",void 0),(0,t.default)(this,"torusIframe",void 0),(0,t.default)(this,"styleLink",void 0),this.torusUrl="",this.isInitialized=!1,this.requestedLoginProvider=null,this.modalZIndex=r,this.alertZIndex=r+1e3,this.dappStorageKey=""}return w(a,[{key:"isLoggedIn",get:function(){return!!this.communicationProvider&&this.communicationProvider.isLoggedIn}},{key:"init",value:function(){var e=C(regeneratorRuntime.mark(function e(){var t,r,n,o,a,s,u,c,d,l,h,p,f,m,v,g,w,y,_,b,I,O,k,R=this,T=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=T.length>0&&void 0!==T[0]?T[0]:{},r=t.buildEnv,n=void 0===r?E.PRODUCTION:r,o=t.enableLogging,a=void 0!==o&&o,s=t.network,u=t.showTorusButton,c=void 0!==u&&u,d=t.useLocalStorage,l=void 0!==d&&d,h=t.buttonPosition,p=void 0===h?A.BOTTOM_LEFT:h,f=t.apiKey,m=void 0===f?"torus-default":f,v=t.extraParams,g=void 0===v?{}:v,!this.isInitialized){e.next=3;break}throw new Error("Already initialized");case 3:return(0,i.setAPIKey)(m),e.next=6,j(n);case 6:return w=e.sent,y=w.torusUrl,_=w.logLevel,D.info(y,"url loaded"),this.torusUrl=y,D.setDefaultLevel(_),a?D.enableAll():D.disableAll(),b=this.handleDappStorageKey(l),(I=new URL(y)).pathname.endsWith("/")?I.pathname+="frame":I.pathname+="/frame",O=new URLSearchParams,b&&O.append("dappStorageKey",b),O.append("origin",window.location.origin),I.hash=O.toString(),this.torusIframe=X('<iframe\n        id="torusIframe"\n        class="torusIframe"\n        src="'.concat(I.href,'"\n        style="display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ').concat(this.modalZIndex.toString(),'"\n      ></iframe>')),this.torusAlertContainer=X('<div id="torusAlertContainer" style="display:none; z-index: '.concat(this.alertZIndex.toString(),'"></div>')),this.styleLink=X('<link href="'.concat(y,'/css/widget.css" rel="stylesheet" type="text/css">')),k=function(){var e=C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){try{window.document.head.appendChild(R.styleLink),window.document.body.appendChild(R.torusIframe),window.document.body.appendChild(R.torusAlertContainer),R.torusIframe.addEventListener("load",C(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,de();case 2:return r=t.sent,R.torusIframe.contentWindow.postMessage({buttonPosition:p,apiKey:m,network:"string"==typeof s?V(s):s,dappMetadata:r,extraParams:g},I.origin),t.next=6,R._setupWeb3({torusUrl:y});case 6:c?R.showTorusButton():R.hideTorusButton(),R.isInitialized=!0,window.torus=R,e();case 10:case"end":return t.stop()}},t)})))}catch(r){t(r)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),e.next=26,Y();case 26:return e.next=28,k();case 28:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=C(regeneratorRuntime.mark(function e(){var t,r,n=this,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.isInitialized){e.next=3;break}throw new Error("Call init() first");case 3:return e.prev=3,this.requestedLoginProvider=t.loginProvider||null,this.requestedLoginProvider||this.communicationProvider._displayIframe({isFull:!0}),e.next=8,new Promise(function(e,r){n.provider._rpcRequest({method:"solana_requestAccounts",params:[n.requestedLoginProvider,t.login_hint]},(0,o.getRpcPromiseCallback)(e,r))});case 8:if(r=e.sent,!(Array.isArray(r)&&r.length>0)){e.next=11;break}return e.abrupt("return",r);case 11:throw new Error("Login failed");case 14:throw e.prev=14,e.t0=e.catch(3),D.error("login failed",e.t0),e.t0;case 18:return e.prev=18,this.communicationProvider.isIFrameFullScreen&&this.communicationProvider._displayIframe(),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[3,14,18,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.communicationProvider.isLoggedIn){e.next=2;break}throw new Error("Not logged in");case 2:return e.next=4,this.communicationProvider.request({method:n.COMMUNICATION_JRPC_METHODS.LOGOUT,params:[]});case 4:this.requestedLoginProvider=null;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cleanUp",value:function(){var e=C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.communicationProvider.isLoggedIn){e.next=3;break}return e.next=3,this.logout();case 3:this.clearInit();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clearInit",value:function(){function e(e){return e instanceof Element||e instanceof Document}e(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),e(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),e(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}},{key:"hideTorusButton",value:function(){this.communicationProvider.hideTorusButton()}},{key:"showTorusButton",value:function(){this.communicationProvider.showTorusButton()}},{key:"setProvider",value:function(){var e=C(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicationProvider.request({method:n.COMMUNICATION_JRPC_METHODS.SET_PROVIDER,params:he({},t)});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"showWallet",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r,i,o,a,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.communicationProvider.request({method:n.COMMUNICATION_JRPC_METHODS.WALLET_INSTANCE_ID,params:[]});case 3:i=e.sent,o=t?"/".concat(t):"",(a=new URL("".concat(this.torusUrl,"/wallet").concat(o))).searchParams.append("instanceId",i),Object.keys(r).forEach(function(e){a.searchParams.append(e,r[e])}),this.dappStorageKey&&(a.hash="#dappStorageKey=".concat(this.dappStorageKey)),new $({url:a,features:G(H)}).open();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var e=C(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.communicationProvider.request({method:n.COMMUNICATION_JRPC_METHODS.USER_INFO,params:[]});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initiateTopup",value:function(){var e=C(regeneratorRuntime.mark(function e(t,r){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=2;break}throw new Error("Torus is not initialized");case 2:return i=U(),this.communicationProvider._handleWindow(i),e.next=6,this.communicationProvider.request({method:n.COMMUNICATION_JRPC_METHODS.TOPUP,params:{provider:t,params:r,windowId:i}});case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.request({method:"send_transaction",params:{message:t.serialize({requireAllSignatures:!1}).toString("hex")}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var t=C(regeneratorRuntime.mark(function t(n){var i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.provider.request({method:"sign_transaction",params:{message:n.serialize({requireAllSignatures:!1}).toString("hex")}});case 2:return i=t.sent,o=e.from(i,"hex"),a=r.Transaction.from(o),t.abrupt("return",a);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"signAllTransactions",value:function(){var t=C(regeneratorRuntime.mark(function t(n){var i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.map(function(e){return e.serialize({requireAllSignatures:!1}).toString("hex")}),t.next=3,this.provider.request({method:"sign_all_transactions",params:{message:i}});case 3:return o=t.sent,a=o.map(function(t){return r.Transaction.from(e.from(t,"hex"))}),t.abrupt("return",a);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.request({method:"sign_message",params:{data:t}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGaslessPublicKey",value:function(){var e=C(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.request({method:"get_gasless_public_key",params:[]});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleDappStorageKey",value:function(e){var t="";if(me&&e){var r=window.localStorage.getItem(N.localStorageKey);if(r)t=r;else{var n="torus-app-".concat(U());window.localStorage.setItem(N.localStorageKey,n),t=n}}return this.dappStorageKey=t,t}},{key:"_setupWeb3",value:function(){var e=C(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u,c,d=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return D.info("setupWeb3 running"),r=new o.BasePostMessageStream({name:"embed_torus",target:"iframe_torus",targetWindow:this.torusIframe.contentWindow}),n=new o.BasePostMessageStream({name:"embed_communication",target:"iframe_communication",targetWindow:this.torusIframe.contentWindow}),i=new oe(r,{}),a=new re(n,{}),i.tryWindowHandle=function(e,t){var r=e;if(!Array.isArray(r)&&pe.includes(r.method)){if(!d.communicationProvider.isLoggedIn)throw new Error("User Not Logged In");var n=U();a._handleWindow(n,{target:"_blank",features:G(K)}),r.windowId=n}i._rpcEngine.handle(r,t)},a.tryWindowHandle=function(e,t){var r=e;if(!Array.isArray(r)&&fe.includes(r.method)){var n=U();a._handleWindow(n,{target:"_blank",features:G(F)}),r.params.windowId=n}a._rpcEngine.handle(r,t)},(s=function(e){var t=i[e],r=d;i[e]=function(e,n){var i=e.method,o=e.params,a=void 0===o?[]:o;if("solana_requestAccounts"===i){if(!n)return r.login({loginProvider:a[0]});r.login({loginProvider:a[0]}).then(function(e){return n(null,e)}).catch(function(e){return n(e)})}return t.apply(this,[e,n])}})("request"),s("sendAsync"),s("send"),u=new Proxy(i,{deleteProperty:function(){return!0}}),c=new Proxy(a,{deleteProperty:function(){return!0}}),this.provider=u,this.communicationProvider=c,e.next=17,Promise.all([i._initializeState(),a._initializeState(he(he({},t),{},{dappStorageKey:this.dappStorageKey,torusAlertContainer:this.torusAlertContainer,torusIframe:this.torusIframe}))]);case 17:D.debug("Torus - injected provider");case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),a}();exports.default=ve;
},{"@babel/runtime/helpers/defineProperty":"xwXl","@solana/web3.js":"WK9J","@toruslabs/base-controllers":"rvL3","@toruslabs/http-helpers":"vkvD","@toruslabs/openlogin-jrpc":"IWup","eth-rpc-errors":"aKHk","is-stream":"zhyU","pump":"J9x6","loglevel":"ohSP","fast-deep-equal":"mdKr","buffer":"aMB2"}],"ZziZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SolanaWalletAdapter=void 0;var t=a(require("@babel/runtime/helpers/defineProperty")),e=a(require("@toruslabs/solana-embed")),i=require("@web3auth/base"),r=require("@web3auth/solana-provider");function a(t){return t&&t.__esModule?t:{default:t}}function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}function o(e){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?n(Object(r),!0).forEach(function(i){(0,t.default)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class s extends i.BaseAdapter{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,t.default)(this,"name",i.WALLET_ADAPTERS.TORUS_SOLANA),(0,t.default)(this,"adapterNamespace",i.ADAPTER_NAMESPACES.SOLANA),(0,t.default)(this,"currentChainNamespace",i.CHAIN_NAMESPACES.SOLANA),(0,t.default)(this,"type",i.ADAPTER_CATEGORY.EXTERNAL),(0,t.default)(this,"status",i.ADAPTER_STATUS.NOT_READY),(0,t.default)(this,"torusInstance",null),(0,t.default)(this,"torusWalletOptions",void 0),(0,t.default)(this,"initParams",void 0),(0,t.default)(this,"loginSettings",{}),(0,t.default)(this,"solanaProvider",null),(0,t.default)(this,"rehydrated",!1),this.torusWalletOptions=e.adapterSettings||{},this.initParams=e.initParams||{},this.loginSettings=e.loginSettings||{},this.chainConfig=e.chainConfig||null}get provider(){var t;return this.status===i.ADAPTER_STATUS.CONNECTED&&this.solanaProvider&&(null===(t=this.solanaProvider)||void 0===t?void 0:t.provider)||null}set provider(t){throw new Error("Not implemented")}async init(t){let a;if(super.checkInitializationRequirements(),this.chainConfig){const{chainId:t,blockExplorer:e,displayName:i,rpcTarget:r,ticker:n,tickerName:o}=this.chainConfig;a={chainId:t,rpcTarget:r,blockExplorerUrl:e,displayName:i,tickerName:o,ticker:n,logo:""}}else{this.chainConfig=(0,i.getChainConfig)(i.CHAIN_NAMESPACES.SOLANA,"0x1");const{blockExplorer:t,displayName:e,ticker:r,tickerName:n,rpcTarget:o,chainId:s}=this.chainConfig;a={chainId:s,rpcTarget:o,blockExplorerUrl:t,displayName:e,ticker:r,tickerName:n,logo:""}}this.torusInstance=new e.default(this.torusWalletOptions),await this.torusInstance.init(o(o({showTorusButton:!1},this.initParams),{},{network:a})),this.solanaProvider=new r.TorusInjectedProvider({config:{chainConfig:this.chainConfig}}),this.status=i.ADAPTER_STATUS.READY,this.emit(i.ADAPTER_EVENTS.READY,i.WALLET_ADAPTERS.TORUS_SOLANA);try{t.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(n){i.log.error("Failed to connect with cached torus solana provider",n),this.emit(i.ADAPTER_EVENTS.ERRORED,n)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw i.WalletInitializationError.notReady("Torus wallet is not initialized");if(!this.solanaProvider)throw i.WalletInitializationError.notReady("Torus wallet is not initialized");this.status=i.ADAPTER_STATUS.CONNECTING,this.emit(i.ADAPTER_EVENTS.CONNECTING,{adapter:i.WALLET_ADAPTERS.TORUS_SOLANA});try{await this.torusInstance.login(this.loginSettings);try{await this.solanaProvider.setupProvider(this.torusInstance.provider)}catch(t){if(!(t instanceof i.Web3AuthError&&5010===t.code))throw t;{const{chainId:t,blockExplorer:e,displayName:i,rpcTarget:r,ticker:a,tickerName:n}=this.chainConfig,o={chainId:t,rpcTarget:r,blockExplorerUrl:e,displayName:i,tickerName:n,ticker:a,logo:""};await this.torusInstance.setProvider(o)}}return this.status=i.ADAPTER_STATUS.CONNECTED,this.torusInstance.showTorusButton(),this.emit(i.ADAPTER_STATUS.CONNECTED,{adapter:i.WALLET_ADAPTERS.TORUS_SOLANA,reconnected:this.rehydrated}),this.provider}catch(t){throw this.status=i.ADAPTER_STATUS.READY,this.rehydrated=!1,this.emit(i.ADAPTER_EVENTS.ERRORED,t),i.WalletLoginError.connectionError("Failed to login with torus solana wallet")}}async disconnect(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleanup:!1};if(this.status!==i.ADAPTER_STATUS.CONNECTED)throw i.WalletLoginError.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw i.WalletInitializationError.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),t.cleanup?(this.status=i.ADAPTER_STATUS.NOT_READY,this.torusInstance=null,this.solanaProvider=null):this.status=i.ADAPTER_STATUS.READY,this.emit(i.ADAPTER_EVENTS.DISCONNECTED)}async getUserInfo(){if(this.status!==i.ADAPTER_STATUS.CONNECTED)throw i.WalletLoginError.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw i.WalletInitializationError.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo()}setAdapterSettings(t){}}exports.SolanaWalletAdapter=s;
},{"@babel/runtime/helpers/defineProperty":"xwXl","@toruslabs/solana-embed":"wEMR","@web3auth/base":"BZvL","@web3auth/solana-provider":"LAMg"}]},{},[], null)
//# sourceMappingURL=/torusSolanaAdapter.esm.47a777ac.js.map